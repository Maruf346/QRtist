{% extends 'base.html' %}

{% block title %}API Documentation - QRtist{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section" style="background: var(--dark-bg);">
    <div class="container text-center">
        <h1 class="display-4 fw-bold mb-3">API Documentation</h1>
        <p class="lead opacity-75">Integrate QRtist with your applications using our RESTful API</p>
        <div class="mt-4">
            <span class="badge bg-success me-2">REST API</span>
            <span class="badge bg-info me-2">JSON Support</span>
            <span class="badge bg-warning">CORS Enabled</span>
        </div>
    </div>
</div>

<!-- Quick Start -->
<div class="container py-5">
    <div class="card border-0 shadow-lg mb-5">
        <div class="card-header bg-white">
            <h4 class="mb-0"><i class="fas fa-rocket me-2"></i>Quick Start</h4>
        </div>
        <div class="card-body p-4">
            <p class="lead mb-4">Generate your first QR code in seconds:</p>
            
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <h6 class="fw-bold mb-3"><i class="fas fa-terminal me-2"></i>cURL Example</h6>
                            <pre class="bg-dark text-light p-3 rounded-3"><code>curl -X POST https://your-domain.com/api/qr/text/ \
  -H "Content-Type: application/json" \
  -d '{"text": "Hello QRtist!"}'</code></pre>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <h6 class="fw-bold mb-3"><i class="fab fa-python me-2"></i>Python Example</h6>
                            <pre class="bg-dark text-light p-3 rounded-3"><code>import requests

response = requests.post(
    "https://your-domain.com/api/qr/text/",
    json={"text": "Hello QRtist!"}
)

print(response.json())
# {"success": true, "qr_code": "data:image/png;base64,..."}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- API Endpoints -->
<div class="container pb-5">
    <h2 class="fw-bold mb-4">Available Endpoints</h2>
    
    <!-- Text QR Endpoint -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <div>
                <span class="badge bg-primary me-2">POST</span>
                <span class="fw-bold">/api/qr/text/</span>
            </div>
            <span class="text-success">Active</span>
        </div>
        <div class="card-body">
            <p class="mb-3">Generate QR code from plain text.</p>
            
            <h6 class="fw-bold mt-4 mb-3">Request Body</h6>
            <div class="card bg-dark text-light mb-3">
                <div class="card-body">
                    <pre><code>{
    "text": "Your text here",
    "size": 10,
    "fill_color": "#000000",
    "back_color": "#FFFFFF"
}</code></pre>
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <h6 class="fw-bold mb-3">Parameters</h6>
                    <table class="table table-sm">
                        <tbody>
                            <tr>
                                <td><code>text</code></td>
                                <td><span class="badge bg-warning">required</span></td>
                                <td>Text content (max 2000 chars)</td>
                            </tr>
                            <tr>
                                <td><code>size</code></td>
                                <td><span class="badge bg-secondary">optional</span></td>
                                <td>QR code size (5-20, default: 10)</td>
                            </tr>
                            <tr>
                                <td><code>fill_color</code></td>
                                <td><span class="badge bg-secondary">optional</span></td>
                                <td>QR color in hex (default: #000000)</td>
                            </tr>
                            <tr>
                                <td><code>back_color</code></td>
                                <td><span class="badge bg-secondary">optional</span></td>
                                <td>Background color in hex (default: #FFFFFF)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="col-md-6">
                    <h6 class="fw-bold mb-3">Response</h6>
                    <div class="card bg-success bg-opacity-10">
                        <div class="card-body">
                            <pre class="mb-0"><code>{
    "success": true,
    "qr_id": "uuid-here",
    "qr_code": "data:image/png;base64,...",
    "content": "Your text here",
    "download_url": "/download/uuid-here/",
    "created_at": "2024-01-01T12:00:00Z"
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-end">
                <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('text')">
                    <i class="fas fa-play me-1"></i> Test Endpoint
                </button>
            </div>
        </div>
    </div>
    
    <!-- URL QR Endpoint -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <div>
                <span class="badge bg-primary me-2">POST</span>
                <span class="fw-bold">/api/qr/url/</span>
            </div>
            <span class="text-success">Active</span>
        </div>
        <div class="card-body">
            <p class="mb-3">Generate QR code from website URL.</p>
            
            <h6 class="fw-bold mt-4 mb-3">Request Body</h6>
            <div class="card bg-dark text-light mb-3">
                <div class="card-body">
                    <pre><code>{
    "url": "https://example.com",
    "size": 10,
    "fill_color": "#000000",
    "back_color": "#FFFFFF"
}</code></pre>
                </div>
            </div>
            
            <div class="text-end">
                <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('url')">
                    <i class="fas fa-play me-1"></i> Test Endpoint
                </button>
            </div>
        </div>
    </div>
    
    <!-- PDF QR Endpoint -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <div>
                <span class="badge bg-primary me-2">POST</span>
                <span class="fw-bold">/api/qr/pdf/</span>
            </div>
            <span class="text-success">Active</span>
        </div>
        <div class="card-body">
            <p class="mb-3">Generate QR code from PDF file.</p>
            
            <h6 class="fw-bold mt-4 mb-3">Request</h6>
            <div class="alert alert-info mb-3">
                <i class="fas fa-info-circle me-2"></i>
                This endpoint uses <code>multipart/form-data</code> for file upload
            </div>
            
            <div class="text-end">
                <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('pdf')">
                    <i class="fas fa-play me-1"></i> Test Endpoint
                </button>
            </div>
        </div>
    </div>
    
    <!-- Image QR Endpoint -->
    <div class="card border-0 shadow-sm mb-5">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <div>
                <span class="badge bg-primary me-2">POST</span>
                <span class="fw-bold">/api/qr/image/</span>
            </div>
            <span class="text-success">Active</span>
        </div>
        <div class="card-body">
            <p class="mb-3">Generate QR code from image file.</p>
            
            <h6 class="fw-bold mt-4 mb-3">Response Codes</h6>
            <div class="row">
                <div class="col-md-4">
                    <div class="card border-success mb-3">
                        <div class="card-body text-center">
                            <div class="display-6 fw-bold text-success">200</div>
                            <small>Success</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-danger mb-3">
                        <div class="card-body text-center">
                            <div class="display-6 fw-bold text-danger">400</div>
                            <small>Bad Request</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-warning mb-3">
                        <div class="card-body text-center">
                            <div class="display-6 fw-bold text-warning">500</div>
                            <small>Server Error</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-end">
                <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('image')">
                    <i class="fas fa-play me-1"></i> Test Endpoint
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Interactive Testing -->
<div class="container pb-5">
    <div class="card border-0 shadow-lg">
        <div class="card-header bg-white">
            <h4 class="mb-0"><i class="fas fa-flask me-2"></i>API Playground</h4>
        </div>
        <div class="card-body p-4">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="fw-bold mb-3">Test Request</h6>
                    <div class="mb-3">
                        <label class="form-label">Select Endpoint</label>
                        <select class="form-select" id="endpointSelect">
                            <option value="text">Text QR (/api/qr/text/)</option>
                            <option value="url">URL QR (/api/qr/url/)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Request Body</label>
                        <textarea class="form-control" id="requestBody" rows="10">{
    "text": "Testing QRtist API",
    "size": 10,
    "fill_color": "#667eea",
    "back_color": "#FFFFFF"
}</textarea>
                    </div>
                    
                    <button class="btn btn-primary w-100" onclick="sendTestRequest()">
                        <i class="fas fa-paper-plane me-2"></i> Send Request
                    </button>
                </div>
                
                <div class="col-md-6">
                    <h6 class="fw-bold mb-3">Response Preview</h6>
                    <div class="card bg-light h-100">
                        <div class="card-body">
                            <pre id="responsePreview" class="mb-0" style="min-height: 300px;">{
    "response": "Will appear here"
}</pre>
                        </div>
                    </div>
                    
                    <div class="mt-3 text-center">
                        <button class="btn btn-outline-secondary" onclick="clearResponse()">
                            <i class="fas fa-trash me-2"></i> Clear
                        </button>
                        <button class="btn btn-outline-success" onclick="copyResponse()">
                            <i class="fas fa-copy me-2"></i> Copy Response
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Rate Limiting -->
<div class="container pb-5">
    <div class="card border-0 bg-primary bg-opacity-10">
        <div class="card-body p-4 text-center">
            <h4 class="fw-bold mb-3"><i class="fas fa-tachometer-alt me-2"></i>Rate Limiting</h4>
            <p class="mb-4">Our API is rate-limited to ensure fair usage and optimal performance for all users.</p>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="card border-0 bg-white shadow-sm">
                        <div class="card-body">
                            <div class="display-6 fw-bold text-primary">100</div>
                            <p class="mb-0">Requests per hour</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 bg-white shadow-sm">
                        <div class="card-body">
                            <div class="display-6 fw-bold text-success">10MB</div>
                            <p class="mb-0">Max file size</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 bg-white shadow-sm">
                        <div class="card-body">
                            <div class="display-6 fw-bold text-warning">Free</div>
                            <p class="mb-0">No credit card required</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
pre {
    background: #1a1d28;
    color: #e2e8f0;
    border-radius: 10px;
    padding: 1.5rem;
    overflow-x: auto;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
}

code {
    color: #667eea;
}

.badge {
    font-size: 0.8rem;
    padding: 0.4rem 0.8rem;
}

.card-header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}
</style>

<script>
function testEndpoint(type) {
    let exampleData = {};
    
    switch(type) {
        case 'text':
            exampleData = {
                text: "Hello from QRtist API!",
                size: 10,
                fill_color: "#667eea",
                back_color: "#FFFFFF"
            };
            break;
        case 'url':
            exampleData = {
                url: "https://github.com/yourusername/QRtist",
                size: 10,
                fill_color: "#4facfe",
                back_color: "#FFFFFF"
            };
            break;
    }
    
    $('#endpointSelect').val(type);
    $('#requestBody').val(JSON.stringify(exampleData, null, 2));
    
    Swal.fire({
        title: 'Test Endpoint',
        text: `Test data loaded for ${type.toUpperCase()} endpoint`,
        icon: 'success',
        timer: 2000,
        showConfirmButton: false
    });
}

function sendTestRequest() {
    const endpoint = $('#endpointSelect').val();
    const requestBody = $('#requestBody').val();
    
    if (!requestBody) {
        Swal.fire('Error', 'Please enter request body', 'error');
        return;
    }
    
    try {
        JSON.parse(requestBody);
    } catch (e) {
        Swal.fire('Error', 'Invalid JSON format', 'error');
        return;
    }
    
    // Show loading
    $('#responsePreview').text('Sending request...');
    
    $.ajax({
        url: `/api/qr/${endpoint}/`,
        type: 'POST',
        data: requestBody,
        contentType: 'application/json',
        headers: {
            'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val()
        },
        success: function(response) {
            $('#responsePreview').text(JSON.stringify(response, null, 2));
            
            if (response.success && response.qr_code) {
                // Show QR code preview
                Swal.fire({
                    title: 'Success!',
                    html: `
                        <div class="text-center">
                            <img src="${response.qr_code}" class="img-fluid rounded-3 mb-3" style="max-width: 200px;">
                            <p>QR code generated successfully!</p>
                        </div>
                    `,
                    confirmButtonText: 'Download',
                    showCancelButton: true,
                    cancelButtonText: 'Close'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = response.download_url;
                    }
                });
            }
        },
        error: function(xhr) {
            $('#responsePreview').text(JSON.stringify(xhr.responseJSON, null, 2));
            Swal.fire('Error', 'Request failed. Check console for details.', 'error');
        }
    });
}

function clearResponse() {
    $('#responsePreview').text('{\n    "response": "Will appear here"\n}');
}

function copyResponse() {
    const text = $('#responsePreview').text();
    navigator.clipboard.writeText(text).then(() => {
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
        });
        Toast.fire({
            icon: 'success',
            title: 'Response copied to clipboard!'
        });
    });
}

// Initialize code highlighting
document.addEventListener('DOMContentLoaded', function() {
    // Add line numbers to code blocks
    document.querySelectorAll('pre code').forEach(block => {
        const lines = block.innerHTML.split('\n');
        const lineNumbers = lines.map((_, i) => i + 1).join('\n');
        
        const wrapper = document.createElement('div');
        wrapper.className = 'code-wrapper';
        wrapper.innerHTML = `
            <div class="line-numbers" style="
                float: left;
                text-align: right;
                padding-right: 1rem;
                color: #666;
                user-select: none;
                font-family: monospace;
            ">${lineNumbers}</div>
            <div style="overflow-x: auto;">${block.outerHTML}</div>
        `;
        
        block.parentNode.replaceChild(wrapper, block);
    });
});
</script>
{% endblock %}